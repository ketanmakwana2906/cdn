const puppeteer = require('puppeteer');

(async () => {
    console.log('hey');

    const options = { headless: true }; // Define options if needed
    const browser = await puppeteer.launch(options);

    try {
        const page = await browser.newPage();
        await page.setDefaultNavigationTimeout(60000);

        console.log('wtf');
        console.log('scanning ... ');

        // Monitor network responses
        page.on("response", async (response) => {
            let urlPattern = `ctpro/mweb/${pnr}`;
            if (response.url().includes(urlPattern)) {
                console.log('scanning success ... ', response.url());
                try {
                    const jsonResponse = await response.json();
                    console.log(jsonResponse);
                } catch (err) {
                    console.error("Error parsing response:", err);
                }
            }
        });

        // Navigate to the page
        await page.goto(`https://www.confirmtkt.com/pnr-status/${pnr}`);

        // Wait for some time to capture responses
        await new Promise(resolve => setTimeout(resolve, 5000));

    } catch (err) {
        console.error("Error:", err);
    } finally {
        await browser.close();
    }
})();
