FROM redhat/ubi8:8.10

# Update the system
RUN echo "sslverify=0" >> /etc/dnf/dnf.conf # only for local machine and not for jenkins machine
RUN yum -y update

# Set the working directory
WORKDIR /app

# Copy the application code
COPY . .

# Install Node.js
RUN dnf install -y nodejs

# Install 'n' for Node.js version management
RUN npm config set strict-ssl false
RUN npm install -g n

# Install the specific Node.js version
RUN echo "insecure" > ~/.curlrc
RUN n 20.13.1

# Install Python 3.12
RUN yum install -y python3.12

# Install dependencies with Puppeteer Chromium download skipped
RUN PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true npm i --legacy-peer-deps

# Expose the port the app runs on
EXPOSE 4000

# Start the application
CMD ["node", "server.js"]
