# myapp/middleware.py
import uuid
from django.utils.deprecation import MiddlewareMixin

class CSPMiddleware(MiddlewareMixin):
    def process_response(self, request, response):
        nonce = uuid.uuid4().hex
        response['Content-Security-Policy'] = (
            f"default-src 'self'; "
            f"script-src 'strict-dynamic' 'nonce-{nonce}'; "
            f"object-src 'none'; "
            f"base-uri 'self';"
        )
        request.csp_nonce = nonce
        return response
