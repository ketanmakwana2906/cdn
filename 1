<head>
    <script>
      (function() {
        var nonce = "{{ request.csp_nonce }}";  // Get nonce from Django

        // Function to add nonce to scripts
        function addNonceToScript(script) {
            if (!script.hasAttribute("nonce")) {
                script.setAttribute("nonce", nonce);
            }
        }

        // Add nonce to all existing scripts
        document.querySelectorAll("script").forEach(addNonceToScript);

        // Watch for newly added script tags
        const observer = new MutationObserver((mutations) => {
            mutations.forEach(mutation => {
                mutation.addedNodes.forEach(node => {
                    if (node.tagName === "SCRIPT") {
                        addNonceToScript(node);
                    }
                });
            });
        });

        observer.observe(document.documentElement, { childList: true, subtree: true });

      })();
    </script>
</head>
