const puppeteer = require('puppeteer');
const randomUseragent = require('random-useragent');

// Oxylabs Proxy Credentials
const OXYLABS_USERNAME = "your_oxylabs_username";
const OXYLABS_PASSWORD = "your_oxylabs_password";
const PROXY_URL = `http://${OXYLABS_USERNAME}:${OXYLABS_PASSWORD}@pr.oxylabs.io:7777`;

async function scrapeWithNewIP(pnr) {
    console.log(`\nRequesting PNR: ${pnr} with a new IP...`);

    const browser = await puppeteer.launch({
        headless: true,
        args: [`--proxy-server=${PROXY_URL}`] // Change IP using Oxylabs
    });

    const page = await browser.newPage();
    await page.setUserAgent(randomUseragent.getRandom());

    await page.goto(`https://www.confirmtkt.com/pnr-status/${pnr}`, { waitUntil: 'networkidle2' });

    console.log(`Loaded page for PNR: ${pnr}`);
    
    await browser.close();
}

// Example Usage (Each call gets a different IP)
(async () => {
    const pnrNumbers = ["1234567890", "2345678901", "3456789012"]; // Example PNR numbers
    for (let pnr of pnrNumbers) {
        await scrapeWithNewIP(pnr);
    }
})();
