<script>
    document.addEventListener("DOMContentLoaded", function () {
        var nonceMeta = document.querySelector("meta[name='csp-nonce']");
        if (nonceMeta) {
            var nonce = nonceMeta.getAttribute("content");

            var originalAppendChild = Element.prototype.appendChild;
            Element.prototype.appendChild = function (node) {
                if (node.tagName === "SCRIPT" && !node.nonce) {
                    node.nonce = nonce;
                }
                return originalAppendChild.call(this, node);
            };

            // Also update existing script tags without nonce
            document.querySelectorAll("script:not([nonce])").forEach(function (script) {
                script.nonce = nonce;
            });
        }
    });
</script>
